[#]: # (man)

NAME
====

mdtest - a manpage-structured markdown test page for doxygen and gitlab


DESCRIPTION
===========

This is a test page and a mini how-to for writing a manpage-stuctured markdown
document that produces nice output for:
- gitlab markdown rendering
- github markdown rendering
- doxygen HTML output
- doxygen manapge output (roff)


DOCUMENT STRUCTURE
==================

Since the document also target manapge output, the structure of the document
follows man page structure with level-1 headers as section headers and level-2
headers as subsection headers.

Usually a man page starts with **NAME** section (level-1 header). However, when
the markdown file starts with level-1 header, doxygen also use the header as a
page title. If we starts with **NAME** ... we will end up having documents
labeled **NAME** in the "Related Pages" of Doxygen HTML output. A trick to avoid
this is to start the markdown document with a bogus link reference as follows:

```md
[#]: #

NAME
====
program - short description
```

Then, doxygen won't use literal **NAME** as the page title in its HTML output,
but use the filename instead (e.g. `mdtest` for this document).


OUTPUT
======

For gitlab and github, the site display markdown files directly. There is no
automatic markdown page indexing. Only the top-level `README.md` get to display
as a front page in the project page.

Doxygen HTML output is confiugred to use `ldms/README.md` as its first page. It
also has *Related Pages* section that contains a list of all pages (markdown
included). The built HTML pages (from `make`) reside in
`<BUILDDIR>/doc/doxygen/html/`. After `make install` they will be installed in
`<PREFIX>/share/doc/ovis-ldms-<VER>/html/`.

Doxygen MAN pages are all generated as SECTION 3 and reside in
`<BUILDDIR>/doc/doxygen/man/man3/`. They have several naming and formatting
issues that the manpage generated by doxygen from markdown file is not usable.
`ldms/doc/mddoxymanfix.sh` is a script that addresses the issues (see the file
for details). The `DOX_MAN` rule in `ldms/doc/Makefile.am` is the rule that
calls the script to post-process the doxygen MAN and generate the final manpage
results residing in `<BUILDDIR>/doc/man/`. After `make install`, the
post-processed man pages are installed in `<PREFIX>/share/man/man<SECTION>/`.

To post-process a doxygen-generated manapge (when `make` is called) and install
it (when `make install` is called), we need to 1) add a Make rule describing the
target file and its doxygen-generated man page dependency, and 2) add the target
file into the proper list (e.g. add `.7` target to `man7_MANS` list) in
`ldms/doc/Makefile.am` as follows:

```Make
# file: ldms/doc/Makefile.am

man/mdtest.7: doxygen/man/man3/md_ldms_doc_mdtest.3

man7_MANS = man/mdtest.7


```

Note that the doxygen-generated man output file name is `md_` and a path to the
file that every `/` is replaced by `_`. For example `ldms/doc/mdtest.md` will be
`md_ldms_doc_mdtest.3`.

See [ldms/doc/Makefile.am](Makefile.am) in the source tree for more
information.


FORMAT TEST
===========

This section contains format testing.


Code Block
----------

```roff
.SH SOME GROFF CODE TEST
.PP
BLA BLA BLA
```

```c
/* some C code test */
int test(float f)
{
    return 0;
}
```


Text Style
----------

*BOLD* ***BOLD-ITALIC***

<b><i>italic in bold</i></b>

<i><b>bold in italic</b></i>

<b> bold <i> italic inside </i> bold again?</b> only work on gitlab and doxygen
HTML. doxygen man does not work because doxygen turns `<i>...</i>` into
`\fI...\fP` (requesting italic style ONLY then swich back to previous style),
and `<b>...</b>` into `\fB...\fP` (requesting bold style ONLY and switch back to
previous style). The bold-italic above works because of an relatively-easy fix
by [ldms/doc/mddoxymanfix.sh](mddoxymanfix.sh).


Section Link
------------

See [SEE ALSO](#see-also). This works on gitlab.

Doxygen HTML doesn't automatically generate the header anchors. Hence, the link
won't work right away. It will display a link, but the link doesn't work. A work
around is to add a `<span id="#see-also"></span>` right under [SEE
ALSO](#see-also) section. This doesn't seem to interfere with the automatically
generated anchors by gitlab and github.

Doxygen MAN display the link in BOLD after a post-processing by
`mddoxymanfix.sh`.


Block Quote
-----------

> This is a quote.
> This also is a quote.
>
> Bla bla bla.
> With some *italic* text.

Horizontal Rule
---------------


----------------------------------


Horizontal rules works on gitlab and doxygen HTML. It doesn't work on doxygen
MAN.



Bullet List
-----------

- bullet one
    - sub one
    - sub another one
        - sub sub one
- bullet two
  - sub two
- bullet three
  - sub three


Definition List
---------------

Need to do this in HTML style because Markdown syntax doesn't have this kind of
list. The list display nicely on all target output (gitlab, doxygen  HTML,
doxygen MAN).

<dl>
<dt>term one</dt>
<dd>This is a description of `term one`.</dd>

<dt>term two</dt>
<dd>This is a description of `term two`.</dd>

<dt>term three</dt>
<dd>This is a description of `term three`.</dd>
</dl>


New Line
--------

This<br>
is a newline.


Strike Through
--------------

`~~` strike: ~~strike-me~~ seems to work only on gitlab.

`<s>` html <s>strike</s> also doesn't work on doxygen. In short, don't use
strike-through.


Link
----

[OGC](http://www.ogc.us)

admin@ogc.us

Refers to [H2](#h2)

Refers to another page [ldmsd-sampler](../src/ldmsd/ldmsd-sampler.md)(7)


HEADER TESTING (H1)
===================
Under H1

H2
--
<span id="h2"></span>
Under H2

H2 is a subsection in doxygen MAN output.

### H3
Under H3

H3 is also a subsection in doxygen MAN output (same level as H2).

#### H4
Under H4

H4 is also a subsection in doxygen MAN output (same level as H2).

##### H5
Under H5

H5 is also a subsection in doxygen MAN output (same level as H2).

###### H6
Unser H6

H6 is also a subsection in doxygen MAN output (same level as H2).


SEE ALSO
========
<span id="see-also"></span>
**ldmsd**(1)
[ldmsd-sampler](../src/ldmsd/ldmsd-sampler.md)(7)
[ldmsd-aggregator](../src/ldmsd/ldmsd-aggregator.md)(7)
