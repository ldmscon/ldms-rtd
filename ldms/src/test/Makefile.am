ACLOCAL_AMFLAGS = -I m4
AM_LDFLAGS = @OVIS_LIB_ABS@
AM_CPPFLAGS = @OVIS_INCLUDE_ABS@
#COMMON_LIBADD = -lldms @LDFLAGS_GETTIME@ -lovis_util -lcoll

sbin_PROGRAMS =
sbin_PROGRAMS += test_ldms_xprt_reconnect
test_ldms_xprt_reconnect_SOURCES = test_ldms_xprt_reconnect.c
test_ldms_xprt_reconnect_LDADD = -lldms
test_ldms_xprt_reconnect_LDFLAGS = $(AM_LDFLAGS) -lpthread

sbin_PROGRAMS += test_ldms_notify
test_ldms_notify_SOURCES = test_ldms_notify.c
test_ldms_notify_LDADD = -lldms
test_ldms_notify_LDFLAGS = $(AM_LDFLAGS) -pthread

sbin_PROGRAMS += test_ldms_xprt_send_recv
test_ldms_xprt_send_recv_SOURCES = test_ldms_xprt_send_recv.c
test_ldms_xprt_send_recv_LDADD = -lldms
test_ldms_xprt_send_recv_LDFLAGS = $(AM_LDFLAGS) -pthread

sbin_PROGRAMS += test_ldms_push
test_ldms_push_SOURCES = test_ldms_push.c
test_ldms_push_LDADD = -lldms
test_ldms_push_LDFLAGS = $(AM_LDFLAGS) -pthread

sbin_PROGRAMS += test_ldms
test_ldms_SOURCES = test_ldms.c
test_ldms_LDADD = -lldms -lovis_util
test_ldms_LDFLAGS = $(AM_LDFLAGS) -pthread

sbin_PROGRAMS += test_ldms_set_info
test_ldms_set_info_SOURCES = test_ldms_set_info.c
test_ldms_set_info_LDADD = -lldms
test_ldms_set_info_LDFLAGS = $(AM_LDFLAGS) -pthread

check_PROGRAMS = test_metric
test_metric_SOURCES = test_metric.c
test_metric_LDADD = -lldms
test_metric_LDFLAGS = $(AM_LDFLAGS) -pthread -lm

EXTRA_DIST=ldms-run-static-tests.sh.in
EXTRA_DIST+=ldms-static-test-list.sh.in
EXTRA_DIST+=ldms-static-test-bypass.in

CLEANFILES=ldms-run-static-tests.sh
CLEANFILES+=ldms-static-test-list.sh
CLEANFILES+=ldms-static-test-bypass 

%.sh: %.sh.in
	$(do_subst) < $< > $@
	chmod 755 $@

install-data-hook: $(CLEANFILES)
	$(MKDIR_P) $(DESTDIR)$(pkglibdir)
	$(INSTALL) -m 755 ldms-static-test-list.sh $(DESTDIR)$(pkglibdir)
	$(INSTALL) -m 755 ldms-run-static-tests.sh $(DESTDIR)$(pkglibdir)
	$(INSTALL) -m 644 ldms-static-test-bypass $(DESTDIR)$(pkglibdir)

uninstall-hook:
	rm $(DESTDIR)$(pkglibdir)/ldms-static-test-list.sh
	rm $(DESTDIR)$(pkglibdir)/ldms-run-static-tests.sh
	rm $(DESTDIR)$(pkglibdir)/ldms-static-test-bypass

TESTS = $(check_PROGRAMS) ldms-run-static-tests.sh
